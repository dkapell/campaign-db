
mixin customSurveyField(field, currentValue, isStaff)
    - const fieldName = field.longname?field.longname:field.name
    - const disabled = !isStaff && field.editable_by ==='staff'
    div.custom-event-field(
        data-fieldname=field.name
        data-visible_to=field.visible_to?field.visible_to:'all'
        data-editable_by=field.editable_by?field.editable_by:'submitter'
    )
        case field.type
            when 'text'

                label.control-label(for=`attendance_data_${field.name}`)= fieldName
                    if field.required
                        span.ms-1.text-danger *
                input.form-control( id=`attendance_data_${field.name}` type="text" name=`attendance[data][${field.name}]` value=currentValue required=field.required data-isrequired=field.required disabled=disabled)
            when 'longtext'
                -
                    const rows = field.rows?Number(field.rows):3;
                    const height = rows * 24;

                +markdownEditor(fieldName, `attendance_data_${field.name}`, `attendance[data][${field.name}]`, rows, height, currentValue, false, {required:field.required, disabled:disabled, maxlength:field.maxlength})
            when 'boolean'
                .form-check.form-switch
                    input.form-check-input(type="checkbox" id=`attendance_data_${field.name}` name=`attendance[data][${field.name}]` checked=currentValue disabled=disabled)
                    label.form-check-label(for=`attendance_data_${field.name}`)= fieldName
            when 'dropdown'
                label.control-label(for=`attendance_data_${field.name}`)= fieldName
                    if field.required
                        span.ms-1.text-danger *
                select.form-select.select2(id=`attendance_data_${field.name}` name=`attendance[data][${field.name}]` data-placeholder=field.placeholder required=field.required data-isrequired=field.required disabled=disabled)
                    if field.placeholder
                        option
                    for item of field.options
                        option(value=item selected=item===currentValue)= item

mixin surveyDefinitionHeader()
    .row.my-2.survey_field-header-row
        .col-lg
            h4 Survey Fields
        .col-lg.text-end
            button.btn.btn-sm.btn-outline-success.add-survey_field-btn
                i.fa.fa-plus.me-1
                | Add Field

mixin surveyField(field,  idx)
    .survey_field-row.border-top.border-start.border-2.my-1.px-2(id=`survey_field-${idx}` )
        input.sort-order.survey_field-input(
            type='hidden'
            id=`survey_field_${idx}_sort_order`
            name=`survey[definition][${idx}][sort_order]`
            value=idx
            data-fieldtype='sort_order'
        )
        .row.my-2
            .col-lg-4
                label.control-label.survey_field-label.handle(
                    style='cursor:ns-resize'
                    for=`survey_field_${idx}_name`
                    data-fieldtype='name'
                )
                    i.fas.fa-arrows-alt-v.fa-fw.me-2
                    | Name
                .ms-4
                    input.form-control.survey_field-input.me-2(
                        type="text",
                        placeholder="Name"
                        name=`survey[definition][${idx}][name]`
                        value=field.name
                        id=`survey_field_${idx}_name`
                        data-fieldtype='name'
                        data-required="true"
                    )
            .col-lg-3
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_icon`
                    data-fieldtype='icon'
                ) Icon
                input.form-control.survey_field-input(
                    type="text"
                    placeholder="Icon"
                    name=`survey[definition][${idx}][icon]`
                    value=field.icon
                    id=`survey_field_${idx}_icon`
                    data-fieldtype='icon'
                )

            .col-lg-2
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_type`
                    data-fieldtype='type'
                ) Type
                select.form-select.survey_field-type(
                    name=`survey[definition][${idx}][type]`
                    id=`survey_field_${idx}_name`
                    data-fieldtype='type'
                    data-required="true"
                    data-placeholder='Type'
                )
                    option
                    each type in ['text', 'longtext', 'boolean', 'dropdown']
                        option(value=type selected=type===field.type)= type

            .col-lg-3.text-end.align-bottom
                button.btn.btn-sm.btn-outline-danger.remove-survey_field-btn.align-bottom(data-bs-toggle="tooltip" title='Remove Field' data-placement="right")
                    i.fas.fa-trash.fa-fw.me-1
                    | Remove

        .row.my-2.field-options.ps-4
            .col-lg-2
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_visible_to`
                    data-fieldtype='visible_to'
                ) Visible To
                select.form-select.form-select-sm.survey_field-input(
                    name=`survey[definition][${idx}][visible_to]`
                    id=`survey_field_${idx}_visible_to`
                    data-fieldtype='visible_to'
                    data-placeholder='Visibility'
                )
                    option
                    each visibility in ['all', 'player', 'staff']
                        option(value=visibility selected=visibility===field.visible_to)= visibility
                .form-text Default: all
            .col-lg-2
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_editable_by`
                    data-fieldtype='editable_by'
                ) Editable By
                select.form-select.form-select-sm.survey_field-input(
                    name=`survey[definition][${idx}][editable_by]`
                    id=`survey_field_${idx}_editable_by`
                    data-fieldtype='editable_by'
                    data-placeholder='Editability'
                )
                    option
                    each editablity in ['submitter', 'staff']
                        option(value=editablity selected=editablity===field.editable_by)= editablity
                .form-text Default: submitter
            .col-lg-4
                label.control-label Options
                br
                .form-check.form-switch.form-check-inline
                    input.form-check-input(
                        type='checkbox'
                        name=`survey[definition][${idx}][required]`
                        id=`survey_field_${idx}_required`
                        data-fieldtype='required'
                        checked=field.required
                    )
                    label.form-check-label(
                        for=`survey_field_${idx}_required`
                        data-fieldtype='required'
                    ) Required

                .form-check.form-switch.form-check-inline
                    input.form-check-input(
                        type='checkbox'
                        name=`survey[definition][${idx}][on_checkin]`
                        id=`survey_field_${idx}_on_checkin`
                        data-fieldtype='on_checkin'
                        checked=field.on_checkin
                    )
                    label.form-check-label(
                        for=`survey_field_${idx}_on_checkin`
                        data-fieldtype='on_checkin'
                    ) On Check-in Form

            .col-lg-2.textarea-options.survey_field-type-options
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_rows`
                    data-fieldtype='rows'
                ) Rows
                input.form-control.survey_field-input.form-control-sm(
                    type="number",
                    placeholder="Rows"
                    name=`survey[definition][${idx}][rows]`
                    value=field.rows
                    id=`survey_field_${idx}_rows`
                    data-fieldtype='rows'
                )
                .form-text Default: 3
            .col-lg-2.textarea-options.survey_field-type-options
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_maxlength`
                    data-fieldtype='maxlength'
                ) Max Length
                input.form-control.survey_field-input.form-control-sm(
                    type="number",
                    placeholder="Characters"
                    name=`survey[definition][${idx}][maxlength]`
                    value=field.maxlength
                    id=`survey_field_${idx}_maxlength`
                    data-fieldtype='maxlength'
                )
                .form-text Default: unlimited
        .row.my-2.dropdown-options.survey_field-type-options.ps-4
            .col-lg-8
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_options`
                    data-fieldtype='options'
                ) Options (comma seperated)
                input.form-control.survey_field-input.form-control-sm(
                    type="text",
                    placeholder="Option 1, Option 2"
                    name=`survey[definition][${idx}][options]`
                    value=field.options?field.options.join(', '):''
                    id=`survey_field_${idx}_options`
                    data-fieldtype='options'
                )
            .col-lg-4
                label.control-label.survey_field-label(
                    for=`survey_field_${idx}_placeholder`
                    data-fieldtype='placeholder'
                ) Placeholder
                input.form-control.survey_field-input.form-control-sm(
                    type="text",
                    placeholder="Placeholder Text"
                    name=`survey[definition][${idx}][placeholder]`
                    value=field.placeholder
                    id=`survey_field_${idx}_placeholder`
                    data-fieldtype='placeholder'
                )




